project_name: greeter
builds:
  - id: bin
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.ShortCommit}}
    gcflags:
      - all=-N -l
    goos:
      - linux
    goarch:
      - amd64

upx:
  - enabled: true
    compress: best

archives:
  - name_template: '{{ .ProjectName }}_{{ replace .Version "v" "" }}_{{ .Os }}_{{ .Arch }}'
    files:
      - yang/**/*
      - greeter.yml
checksum:
  name_template: checksums.txt
snapshot:
  name_template: "{{ .Tag }}-next"
publishers:
  - name: fury.io deb/rpm packages
    ids:
      - greeter-nfpms # this id belongs to nfpm section and is used to only upload artifacts from nfpm
    dir: "{{ dir .ArtifactPath }}"
    cmd: curl -F package=@{{ .ArtifactName }} https://{{ .Env.FURY_TOKEN }}@push.fury.io/netdevops/
release:
  prerelease: auto
changelog:
  use: github-native

nfpms:
  - id: greeter-nfpms
    file_name_template: '{{ .ProjectName }}_{{ replace .Version "v" "" }}_{{ .Os }}_{{ .Arch }}'
    package_name: ndk-greeter-go
    maintainer: Roman Dodin <dodin.roman@gmail.com>
    homepage: https://learn.srlinux.dev
    description: |
      Greeter NDK app
    vendor: Nokia
    license: GNU GPLv3
    formats:
      - deb
    bindir: /usr/local/bin
    contents:
      - src: ./greeter
        dst: /usr/local/bin/
      - src: ./yang
        dst: /opt/greeter/yang
      - src: ./greeter.yml
        dst: /etc/opt/srlinux/appmgr/
